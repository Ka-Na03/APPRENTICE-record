# インフラについての概要をまとめる

## インフラの構築

1. サーバーの構成
   - どのようなサーバーが必要か考える
   - サーバーを設置する
   - サーバーのOSをインストールし、各種設定を行う
   - 必要なソフトウェアをインストールし、設定する
2. ネットワークの構成
   - ネットワークで使用するIPアドレスの範囲を決める
   - サーバーにIPアドレスを割り当てる
   - ドメイン名とIPアドレスの対応を割り当てる

どのようなサーバーが必要か考えそれに対応したソフトウェアをインストールする
ネットワークの構成を考え、サーバーをネットワークに接続する

## そもそもAWSとは

AWS（Amazon Web Services）、Amazon社が提供するクラウドサービス

1. サービスが豊富
2. リソースが柔軟
3. 従量課金制度

## インフラ等の用語を解説

1. インフラとは
   - Infrastructure：基盤
2. サーバーとは
   - クライアントに対してサービスを適用するコンピューター
3. コンピューターとは
   - パソコン本体など
   - サーバーもそのうちにはいる
4. ネットワークとは
   - 複数のコンピューターを繋いで、データを送受信できるようにする
5. クラウドとは
   - ネットワークを利用してコンピューターリソースを利用する形態
   - オンプレミスとクラウドに二分化されている
6. オンプレミスとは
   - インフラを自前で用意して、自社で所有・管理すること
   - 利点は、自由度が高い
   - 欠点は、初期コストがかかり、調達期間が必要で、サーバーの増減がしにくいこと
7. クラウド
   - インフラをネットワーク経由で使用・管理すること
   - 利点は、初期コストが少なく、すぐに始めることができ、サーバーの増減が自由にできること
   - 欠点は、費用の予測がしにくいこと、クラウド全体で障害がおこると対応のしようがない

**まとめ**

- インフラとは、サーバーやネットワークのこと
- サーバーとは、クライアントに対してサービスを提供するコンピューターの事
- ネットワークとは、複数のコンピューターを繋いで、データを送受信できるようにするもの
- クラウドとは、ネットワークを利用してコンピューターリソースを利用する形態のこと

## VPCについて

- リージョンとは、AWSの各サービスが提供されている地域
  - 接続する地域が近いところのリージョンを選ぶ事で、応答速度が早くなる
  - リージョンの中にアベイラビリティーゾーンが2つ以上ある
- アベイラビリティーゾーンとは、物理的に独立したデータセンターのこと
  - アベイラビリティーゾーンの中にサブネットを設ける
- サブネットとは、VPCを細かく区切ったネットワークのこと
  - パブリックサブネットとプライベートサブネットを分ける
  - Webサーバーと、DBサーバーでそれぞれ作る
  - 複数のアベイラビリティーゾーンの中にサブネットを作り、サーバーをそれぞれ分けて作成する
- VPCとは、AWS上で仮想ネットワークを作成できるサービス
  - リージョンの中に大きくVPCを作り、アベイラビリティーゾーンの中にサブネットを作る。

**ポイント**  
- 複数のアベイラビリティーゾーンに複数のサブネットを作りサーバーやDB等をそれぞれ分けて作成することで思わぬアクシデントに対応できるようにする

IAMユーザーの作成手順：
1. AWSマネジメントコンソール内の検索ボックスに「ＩＡＭ」と入力し、一番上に出てくるであろう「Identity and Access Management (IAM)」をクリック
2. 画面左側のアクセス管理タブの中にある「**ユーザー**」を選択し、表示された画面の「ユーザーを追加」をクリック
3. ユーザー名を任意の名前で登録し、「AWS マネジメントコンソールへのユーザーアクセスを提供する」オプションを選択
4. ユーザータイプを「IAM ユーザーを作成します」にし、パスワードを決める
5. 自分がＩＡＭユーザーを使う場合、下にあるチェックボックスを外して、ログイン後のパスワードリセットを行わないようにする

大まかなVPCの作成手順：  

1. リージョンを確認して、VPCを作成
2. 必要な数のサブネットを作成、以下は例
   - パブリックサブネット：Webサーバーを置く場所
   - プライベートサブネット：DBサーバーを置く場所
3. インターネットゲートウェイを作成
4. ルートテーブルを作成し、local以外のターゲットとしてインターネットゲートウェイをアタッチし、パブリックサブネットを関連付ける


詳細なVPCの作成手順：  

1. AWSマネジメントコンソールにIAMユーザーでログインする
2. コンソール内の検索ボックスに「VPC」と入力し、一番上に出てくる「VPC」をクリック
3. 現在のリージョンを確認して、画面左側の仮想プライベートクラウドタブの中にある「**お使いのVPC**」をクリック
   - 画面には現在作成されているVPCの一覧が表示されていて、その中にAWSでデフォルトで作成されているVPCもあるが、気にしなくてＯＫ
4. 画面に表示された「ＶＰＣを作成」をクリックし作成画面に移動
5. 作成するリソースを選択し、任意の名前を付ける、例：「aws-infra-vpc」等
6. IPv4 CIDRを任意の範囲で決める、決める際のポイントとしてプライベートIPアドレス範囲から指定する  
   VPCでは仮想プライベートネットワーク空間作成するので、プライベートIPアドレスの使用が推奨される
   - 10.0.0.0 ～ 10.255.255.255
   - 172.16.0.0 ～ 172.31.255.255
   - 192.168.0.0 ～ 192.168.255.255
   - 作成後は変更できないので、大きめに設定することも推奨される、具体的な大きさは「/28から/16」の範囲で**推奨は/16**
7. IPv6 CIDRブロックは指定せずテナンシーもデフォルトでかまわない
8. 「VPCを作成を」クリックで作成が完了される、画面を戻り正しく作成されているか確認する

詳細なサブネットの作成手順：  

1. AWSマネジメントコンソールにIAMユーザーでログインする
2. コンソール内の検索ボックスに「VPC」と入力し、一番上に出てくる「VPC」をクリック
3. 現在のリージョンを確認して、画面左側の仮想プライベートクラウドタブの中にある「**サブネット**」をクリック
4. 画面に表示された「サブネットを作成」をクリックし、作成画面に移動
5. 先に作成したVPCを選択し、任意のサブネット名を決める、例：「aws-infra-**public**-subnet-**1a**」
6. アベイラビリティーゾーンを任意のゾーンに選択する
   - リージョンが東京である「ap-northeast-1」の場合、アベイラビリティーゾーンは3個ある
   - リージョン名の末尾にアルファベットがついた「ap-northeast-1**a**」の他に、同じように末尾にアルファベットが付いた**c**と**d**がある
   - サブネット名を決める際はそのサブネットが**public**か**private**か分かる様に記載し、アベイラビリティーゾーンも分かるようにした方が良い
7. IPv4 CIDRブロックを決める
   - 将来に必要なIPアドレス数を見積もって設定する、「/24」が標準
8. 追加でもう一つサブネットを作る場合は「新しいサブネットを追加」クリックするとSTEP 5 のサブネット名から作成できる
9. 「サブネットを作成」をクリックで作成が完了される、画面を戻り正しく作成されているか確認する

残ったインターネットゲートウェイとルートテーブル作成の詳細な手順：  

1. AWSマネジメントコンソールにIAMユーザーでログインする
2. コンソール内の検索ボックスに「VPC」と入力し、一番上に出てくる「VPC」をクリック
3. 現在のリージョンを確認して、画面左側の仮想プライベートクラウドタブの中にある「**インターネットゲートウェイ**」をクリック
4. 画面に表示された「インターネットゲートウェイの作成」をクリックし作成画面に移動
5. 任意の名前を入力して「**インターネットゲートウェイの作成**」をクリックして作成する、例：「aws-infra-igw」
6. ここまでの工程では作成しただけで、どのVPCにも**アタッチ**（関連付け）されていないので先ほど作成したigwを選んで「アクション」クリックし、「**VPCにアタッチ**」をクリックするとVPCの選択画面に移動する
7. 任意のVPCを指定し、「アタッチ」することで作成したインターネットゲートウェイが選択したVPCと関連付けられる
8. アタッチ等が正しく行われているか確認して、次にルートテーブルの作成に移る
9. 画面左側の仮想プライベートクラウドタブの中にある「**ルートテーブル**」をクリック
10. 画面に表示された「**ルートテーブルを作成**」をクリックし作成画面に移動
11. 任意の名前を入力して、ルートテーブルに使用するVPCを選ぶ、例：「aws-infra-public-route」
    - ここで作成するルートテーブルはパブリックになっている理由は簡単で、インターネットに接続するためのルートテーブルだから
12. 「ルートテーブルを作成」をクリックで作成が完了される、画面を戻り正しく作成されているか確認する
13. 作成したルートテーブルはVPCに割り当てられていて、それをパブリックサブネットにも関連付ける
14. 作成したルートテーブルを選択し、画面下にある「**サブネットの関連付け**」をクリックし、そこにある「**サブネットの関連付けを編集**」をクリックしてサブネットの関連付けの編集画面に移動
15. 前の工程で作成した「**public**」サブネットを選択して保存
16. 次に同じルートテーブルのルートを編集し、**0.0.0.0/0**のデフォルトのルート設定変更する
17. 作成したルートテーブルを選択し、画面下にある「**ルート**」をクリックし、そこにある「**ルートを編集**」をクリックしてルートの編集画面に移動
18. 現在はVPCのIPアドレスが送信先でターゲットとして「local」が指定されている
19. 下にある「ルートを追加」で送信先に「**0.0.0.0/0**」を指定し、ターゲットのボックスにある「インターネットゲートウェイ」を選択すると先ほど作成したインターネットゲートウェイのIDが表示されるので、それを選択し「変更を保存」をクリック
20. 正しく設定されたかの確認をする


## EC2について

- 数分で起動し、1時間または秒単位の従量課金
- サーバーの追加・削除、マシンスペック変更も数分で可能
- OSより上のレイヤについては自由に設定できる

作成手順：  
1. AMIの選択
2. インスタンスタイプの選択
3. ストレージの追加
4. セキュリティグループの設定
5. SSHキーペアの設定

## AMIとは
Amazon Machine Imageの略  
- インスタンス起動に必要な情報が入ったOSの様なイメージで、**サーバーのテンプレートの様なもの**
- AMIにはOSのデーターが入っているので、AMIを利用して簡単にOSを入れることができる
- 自前でカスタムAMIを作る事もできる

## インスタンスタイプとは
- インスタンスタイプによって、CPU、メモリ、ストレージ、ネットワーク帯域が異なり、それによって料金が異なる
- アクセス数によって必要なスペックのインスタンスタイプを選択する必要がある
- **サーバーのスペックを定義するもの**

`m5.xlarge`という様な形式で定義される

以下に、よく使われるインスタンスタイプの例とそれらの概要を説明します。

**1. インスタンスファミリー**

- **汎用（General Purpose）**: バランスの取れたリソースを提供し、一般的なワークロードに適しています。例えば、t3、m5などがあります。

- **コンピューティング最適化（Compute Optimized）**: プロセッサ性能に重点を置いたコンピューティングワークロード向けのインスタンスタイプです。例えば、c5、c6gなどがあります。

- **メモリ最適化（Memory Optimized）**: メモリ集中型のワークロードに適したインスタンスタイプで、大量のメモリを提供します。例えば、r5、x1などがあります。

- **ストレージ最適化（Storage Optimized）**: 大容量のストレージを提供し、データベースやデータウェアハウスなどのストレージ重視のワークロードに適しています。例えば、i3、d2などがあります。

- **加速最適化（Accelerated Computing）**: GPUやFPGAなどのアクセラレータを備えたワークロードに適したインスタンスタイプです。例えば、g4、p3などがあります。

**2. インスタンス世代**

AWSは定期的に新しいインスタンス世代を導入しており、より高いパフォーマンスや新機能を提供しています。新しい世代のインスタンスは、前の世代よりも進化しており、より優れたパフォーマンスや最新のテクノロジーを備えています。例えば、現在の世代は「第6世代」であり、それ以前の世代は「第5世代」や「第4世代」となります。

**3. インスタンスサイズ**

インスタンスサイズは、リソース（CPU、メモリ、ストレージ）の量を示します。異なるサイズは異なる仕様を持ち、さまざまなパフォーマンスレベルを提供します。サイズはインスタンスファミリーや世代によって異なりますが、例えば「micro」「small」「large」「xlarge」などのサイズがあります。サイズの選択は、ワークロードの要件や予算に基づいて行われます。

これらは一般的なインスタンスタイプのカテゴリと一部の例です。AWSでは、さまざまなインスタンスタイプが提供されており、ユーザーは自身のワークロードや要件に合わせて最適なインスタンスタイプを選択できます。

## ストレージとは

**サーバーに付随するデータの保存場所**  

**EBS（Elastic Block Store）**

- 高い可用性と耐久性を持つストレージ
- 他のインスタンスに付け替え可能
- EC2インスタンスを`Stop/Terminate`してもEBSは保持可能
- Snapshotを取得しS3に保存可能
- EBSを利用する場合別途で費用が発生する
- OSやDBなどの永続性と耐久性が必要なデータを置く

**インスタンスストア（Instance Store）**

- インスタンス専用の一時的なストレージ
- 他のインスタンスに付け替え不可
- EC2インスタンスを`Stop/Terminate`すると全削除（クリア）される
- 追加費用なしの無料で利用できる（EC2の利用料金のみ）
- 一時ファイル、キャッシュなどの失われても問題がないデータを置く

**Amazon S3（Simple Storage Service）**

- オブジェクトストレージサービスで、大容量のデータを安価に保存できます。
- インターネットを介してデータにアクセスできます。
- バックアップ、静的なウェブサイトのホスティング、データアーカイブなどに使用します。
- 頻繁に変更されるデータやリアルタイムのアクセスが必要な場合は、EBSよりも適していません。

**注意点:**
- インスタンスストアは一時的なストレージなので、重要なデータは定期的にバックアップして別の場所に保存する必要があります。
- EBSボリュームは、インスタンスのリージョン内での可用性があるため、データの耐久性が向上しますが、複数のAZでの冗長性は提供しません。データの冗長性を確保する場合は、EBSスナップショットを使用してバックアップを作成することが推奨されます。
- S3はスケーラブルなストレージであり、耐久性と可用性が非常に高いですが、低いレイテンシが求められるアプリケーションには適していません。

使い分ける際には、データの重要性、アクセスの頻度、パフォーマンスの要件などを考慮し、適切なストレージタイプを選択してください。

## EC2の具体的な作成手順

